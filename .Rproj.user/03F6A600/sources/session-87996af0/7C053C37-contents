---
title: "Analisis Prediktif Penyakit Jantung Menggunakan Seleksi Fitur dan Random Forest"
author: "Nama Anda"
date: "`r Sys.Date()`"
output:
  pdf_document:
    citation_package: natbib
    template: bwHandout.tex
    includes:
       in_header: preamble.tex
    keep_tex: false
    toc: true
    toc_depth: 3
    number_sections: true
    latex_engine: xelatex
lof: true    
fontsize: 11pt
geometry: margin=1in
bibliography: references.bib
my_subtitle: "(Laporan Proyek)"
fancy: true
---

```{r setup, include=FALSE}
# Konfigurasi global
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, fig.align = 'center', comment = NA, out.width = "90%")

# Memuat library yang dibutuhkan
library(tidyverse)
library(caret)
library(randomForest)
library(pROC)
library(gridExtra)
library(scales)
library(reshape2)
library(knitr)
```

# Pendahuluan

## Latar Belakang

Gagal jantung merupakan penyakit kardiovaskular kronis dengan morbiditas dan mortalitas tinggi secara global \citep{savarese2022global}. Peningkatan kasus yang signifikan, terutama di kawasan Asia, menuntut adanya strategi identifikasi dini yang efektif untuk menekan angka hospitalisasi dan kematian \citep{feng2024epidemiology, yan2023burden}. Penilaian risiko konvensional seringkali bergantung pada penilaian subjektif klinisi yang dapat menyebabkan ketidakakuratan dalam stratifikasi risiko pasien \citep{sabouri2023machine}.

Penerapan algoritma *machine learning*, khususnya *Random Forest*, telah menunjukkan potensi besar dalam meningkatkan akurasi diagnosis dan prognosis penyakit jantung dibandingkan metode tradisional \citep{saqib2024machine, chulde2025classification}. Penelitian ini bertujuan untuk mengembangkan model prediktif berbasis *Random Forest* dengan integrasi seleksi fitur untuk mengidentifikasi pasien berisiko tinggi secara lebih akurat dan efisien.

## Rumusan Masalah dan Tujuan

Penelitian ini berfokus pada tiga aspek utama:
1.  Analisis karakteristik data klinis pasien gagal jantung.
2.  Evaluasi kinerja model klasifikasi *Random Forest* (akurasi, presisi, *recall*, F1-score).
3.  Identifikasi fitur klinis yang paling signifikan dalam memprediksi risiko penyakit jantung.

Tujuan utamanya adalah membangun model klasifikasi yang robust dan menginterpretasikan fitur-fitur klinis dominan yang berkontribusi terhadap risiko penyakit jantung.

# Metodologi Penelitian

Penelitian ini mengadopsi kerangka kerja CRISP-DM (*Cross-Industry Standard Process for Data Mining*), yang meliputi pemahaman data, pra-pemrosesan, pemodelan, dan evaluasi.

## Sumber Data

Data yang digunakan bersumber dari "Heart Failure Prediction Dataset" yang terdiri dari 918 observasi dan 12 variabel klinis. Variabel target adalah `HeartDisease` (biner: 0 = Normal, 1 = Sakit Jantung).

## Eksplorasi dan Pra-pemrosesan Data

Tahap awal melibatkan pemeriksaan struktur data dan identifikasi anomali.

```{r data-loading}
df <- read.csv("heart.csv")
# Ringkasan struktur data ditampilkan pada lampiran jika diperlukan
```

Berdasarkan eksplorasi awal, ditemukan dua anomali utama pada variabel numerik:
1.  **`RestingBP` (Tekanan Darah):** Terdapat nilai 0 mmHg yang tidak fisiologis.
2.  **`Cholesterol`:** Terdapat sejumlah nilai 0 mg/dl yang mengindikasikan *missing values*.

Visualisasi distribusi data dilakukan untuk memahami karakteristik variabel terhadap target penyakit jantung.

```{r eda-visualizations, echo=FALSE, fig.cap="Distribusi Variabel Utama terhadap Status Penyakit Jantung", fig.height=6}
p1 <- ggplot(df, aes(x = factor(HeartDisease), fill = factor(HeartDisease))) +
  geom_bar(stat = "count") +
  geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5) +
  scale_fill_manual(values = c("0" = "#2ecc71", "1" = "#e74c3c")) +
  labs(title = "Distribusi Target", x = "Status (0=Sehat, 1=Sakit)", y = "Jumlah") +
  theme_minimal() + theme(legend.position = "none")

p2 <- ggplot(df, aes(x = Age, fill = factor(HeartDisease))) +
  geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
  scale_fill_manual(values = c("0" = "#2ecc71", "1" = "#e74c3c")) +
  labs(title = "Distribusi Usia", x = "Usia", y = "Frekuensi") +
  theme_minimal() + theme(legend.position = "none")

p3 <- ggplot(df %>% filter(Cholesterol > 0), aes(x = Cholesterol, fill = factor(HeartDisease))) +
  geom_histogram(bins = 30, alpha = 0.7, position = "identity") +
  scale_fill_manual(values = c("0" = "#2ecc71", "1" = "#e74c3c")) +
  labs(title = "Distribusi Kolesterol", x = "Kolesterol", y = "Frekuensi") +
  theme_minimal() + theme(legend.position = "none")

p4 <- ggplot(df, aes(x = Sex, fill = factor(HeartDisease))) +
  geom_bar(position = "fill") +
  scale_fill_manual(values = c("0" = "#2ecc71", "1" = "#e74c3c")) +
  scale_y_continuous(labels = percent) +
  labs(title = "Proporsi per Gender", x = "Gender", y = "Proporsi") +
  theme_minimal() + theme(legend.position = "none")

grid.arrange(p1, p2, p3, p4, ncol = 2)
```

Analisis visual menunjukkan bahwa pasien dengan penyakit jantung cenderung berusia lebih tua dan memiliki kadar kolesterol yang bervariasi. Selain itu, proporsi penyakit jantung lebih tinggi pada laki-laki. Analisis variabel kategorikal `ChestPainType` dan `ST_Slope` juga menunjukkan pola diagnostik yang kuat, di mana tipe nyeri dada asimptomatik (ASY) dan *slope* ST yang datar atau menurun memiliki asosiasi tinggi dengan penyakit jantung.

### Penanganan *Missing Values* dan Partisi Data

Strategi pembersihan data dilakukan sebagai berikut:
1.  Observasi dengan `RestingBP` = 0 dihapus karena jumlahnya tidak signifikan (<1%).
2.  Data dibagi menjadi set latih (80%) dan set uji (20%) menggunakan *stratified sampling*.
3.  Nilai `Cholesterol` = 0 diimputasi menggunakan median dari data latih untuk mencegah *data leakage*.
4.  Variabel kategorikal dikonversi menjadi tipe faktor.

```{r data-preparation}
# Menghapus data RestingBP tidak valid
df_clean <- df %>% filter(RestingBP > 0)

# Partisi Data
set.seed(26)
trainIndex <- createDataPartition(df_clean$HeartDisease, p = .8, list = FALSE, times = 1)
train_data <- df_clean[ trainIndex,]
test_data  <- df_clean[-trainIndex,]

# Imputasi Kolesterol
valid_chol_median <- median(train_data$Cholesterol[train_data$Cholesterol > 0], na.rm = TRUE)
train_data$Cholesterol[train_data$Cholesterol == 0] <- valid_chol_median
test_data$Cholesterol[test_data$Cholesterol == 0] <- valid_chol_median

# Konversi ke Faktor
categorical_cols <- c('Sex', 'ChestPainType', 'RestingECG', 'ExerciseAngina', 'ST_Slope', 'FastingBS', 'HeartDisease')
train_data <- train_data %>% mutate(across(all_of(categorical_cols), as.factor))
test_data <- test_data %>% mutate(across(all_of(categorical_cols), as.factor))
```

Analisis korelasi antar fitur numerik menunjukkan tidak adanya multikolinearitas yang tinggi (semua koefisien korelasi < 0.6), sehingga aman untuk pemodelan.

# Hasil dan Pembahasan

## Pemodelan Awal (*Baseline Model*)

Model *Random Forest* awal dilatih menggunakan seluruh fitur (11 variabel) dengan validasi silang 10-lipatan (*10-fold Cross-Validation*). Pra-pemrosesan meliputi pemusatan dan penskalaan data (*centering and scaling*).

```{r modeling-baseline}
set.seed(18)
trControl <- trainControl(method = "cv", number = 10) 

model_rf_baseline <- train(HeartDisease ~ ., 
                           data = train_data, 
                           method = "rf",
                           trControl = trControl,
                           preProcess = c("center", "scale"),
                           importance = TRUE)
```

Hasil evaluasi *Variable Importance* dari model *baseline* digunakan untuk mengidentifikasi fitur yang kurang berkontribusi. Fitur `FastingBS` dan `RestingECG` menunjukkan kontribusi yang minimal (<5%) terhadap model, sehingga diputuskan untuk dieliminasi guna menyederhanakan model tanpa mengorbankan performa.

## Seleksi Fitur dan Model Final

Model final dibangun kembali menggunakan 9 fitur terpilih: `ST_Slope`, `Oldpeak`, `MaxHR`, `ExerciseAngina`, `Age`, `Cholesterol`, `RestingBP`, `ChestPainType`, dan `Sex`.

```{r modeling-final}
# Seleksi Fitur
selected_features <- c("ST_Slope", "Oldpeak", "MaxHR", "ExerciseAngina", 
                       "Age", "Cholesterol", "RestingBP", "ChestPainType", 
                       "Sex", "HeartDisease")

train_data_final <- train_data %>% select(all_of(selected_features))
test_data_final <- test_data %>% select(all_of(selected_features))

# Training Model Final
set.seed(18)
model_rf_final <- train(HeartDisease ~ ., 
                        data = train_data_final,
                        method = "rf",
                        trControl = trControl,
                        preProcess = c("center", "scale"))
```

Perbandingan kinerja validasi silang antara model *baseline* dan model final menunjukkan hasil yang kompetitif. Penyederhanaan model terbukti efektif mempertahankan akurasi sekaligus mengurangi kompleksitas komputasi.

## Evaluasi Model pada Data Uji

Model final dievaluasi menggunakan data uji yang belum pernah dilihat sebelumnya (*unseen data*). Metrik evaluasi meliputi Akurasi, Kappa, Sensitivitas, Spesifisitas, dan AUC.

```{r evaluation-final}
y_pred_final <- predict(model_rf_final, newdata = test_data_final)
cm_final <- confusionMatrix(y_pred_final, test_data_final$HeartDisease)
```

Tabel berikut merangkum kinerja model final pada data uji:

| Metrik | Nilai | Interpretasi |
| :--- | :--- | :--- |
| **Akurasi** | `r round(cm_final$overall['Accuracy'], 4)` | Proporsi prediksi benar keseluruhan tinggi. |
| **Kappa** | `r round(cm_final$overall['Kappa'], 4)` | Kesepakatan prediksi yang kuat (di atas kebetulan). |
| **Sensitivitas** | `r round(cm_final$byClass['Sensitivity'], 4)` | Kemampuan mendeteksi pasien sakit sangat baik. |
| **Spesifisitas** | `r round(cm_final$byClass['Specificity'], 4)` | Kemampuan mengidentifikasi pasien sehat baik. |
| **F1-Score** | `r round(cm_final$byClass['F1'], 4)` | Keseimbangan harmonis antara presisi dan recall. |

Visualisasi *Confusion Matrix* dan kurva ROC disajikan untuk memberikan gambaran performa klasifikasi yang lebih komprehensif.

```{r performance-visualization, echo=FALSE, fig.cap="Evaluasi Model: ROC Curve dan Confusion Matrix", fig.height=5}
y_pred_prob <- predict(model_rf_final, newdata = test_data_final, type = "prob")
roc_obj <- roc(test_data_final$HeartDisease, y_pred_prob[,2])
auc_value <- auc(roc_obj)

p_roc <- ggroc(roc_obj, size = 1, color = "#e74c3c") +
  geom_abline(slope = 1, intercept = 1, linetype = "dashed", color = "gray") +
  labs(title = paste("ROC Curve (AUC =", round(auc_value, 3), ")"),
       x = "Specificity", y = "Sensitivity") + theme_minimal()

cm_df <- as.data.frame(cm_final$table)
p_cm <- ggplot(cm_df, aes(x = Reference, y = Prediction, fill = Freq)) +
  geom_tile(color = "white") +
  geom_text(aes(label = Freq), size = 6, color = "white") +
  scale_fill_gradient(low = "#3498db", high = "#e74c3c") +
  labs(title = "Confusion Matrix", x = "Aktual", y = "Prediksi") +
  theme_minimal() + theme(legend.position = "none")

grid.arrange(p_roc, p_cm, ncol = 2)
```

Nilai AUC sebesar `r round(auc_value, 3)` mengindikasikan kemampuan diskriminasi model yang sangat baik dalam membedakan antara pasien berisiko dan tidak.

## Analisis Fitur Penting

Berdasarkan model final, fitur-fitur yang paling berpengaruh terhadap prediksi risiko penyakit jantung diidentifikasi.

```{r plot-importance-final, echo=FALSE, fig.cap="Variable Importance Model Final", fig.height=4}
var_imp_final <- varImp(model_rf_final)
plot(var_imp_final, main = "Variable Importance (Model Final)")
```

Hasil menunjukkan bahwa `ST_Slope`, `Oldpeak`, dan `MaxHR` merupakan indikator klinis terkuat. Hal ini konsisten dengan literatur medis yang menyatakan bahwa parameter respons jantung terhadap aktivitas fisik (seperti yang tercermin dalam tes *stress ECG*) adalah prediktor vital untuk iskemia miokard.

# Kesimpulan

Penelitian ini berhasil mengembangkan model klasifikasi *Random Forest* untuk prediksi penyakit jantung dengan performa yang memuaskan. Melalui proses seleksi fitur, model disederhanakan menjadi 9 variabel klinis utama tanpa penurunan akurasi yang signifikan. Fitur-fitur yang berkaitan dengan respons latihan fisik (*ST Slope*, *Oldpeak*, *MaxHR*) teridentifikasi sebagai prediktor paling dominan. Model ini memiliki potensi untuk digunakan sebagai alat bantu pengambilan keputusan klinis (*Clinical Decision Support System*) untuk skrining awal risiko penyakit jantung.

\newpage
# Daftar Pustaka

