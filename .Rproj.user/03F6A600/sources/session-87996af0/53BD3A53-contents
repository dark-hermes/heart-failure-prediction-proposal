---
title: \large\bfseries{Kelompok 7 Kelas B}
author: "Irham Maulana Johani | Hermawan Sentyaki Sarjito | Jonathan"
date: "`r Sys.Date()`"
output:
  pdf_document:
    citation_package: natbib
    template: bwHandout.tex
    includes:
       in_header: preamble.tex
    keep_tex: false
    toc: true
    toc_depth: 3
    number_sections: true
    latex_engine: xelatex
#lot: true
lof: true    
fontsize: 11pt
geometry: margin=1in

bibliography: references.bib
#nocite: | 
#  @*

my_subtitle: "(Proposal)"
fancy: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\begin{figure}[h]
\centering
\includegraphics[width=6.5cm]{gambar/vokasi6.png}
\end{figure}

\addtocounter{section}{0}
\setcounter{page}{1}

\newpage

\vspace{0.5cm}   
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,width=0.8\textwidth,center]
\begin{center}
\textbf{Analisis Prediktif Penyakit Jantung Menggunakan Algoritma Klasifikasi (Random Forest) Berbasis Data Klinis}
\end{center}
\end{tcolorbox}
\vspace{0.5cm}

# Latar Belakang

Gagal jantung merupakan salah satu penyakit kardiovaskular kronis dengan angka kesakitan dan kematian yang tinggi secara global, sehingga menjadi beban besar bagi sistem kesehatan \citep{savarese2022global}. Studi epidemiologi terbaru menunjukkan bahwa jumlah kasus gagal jantung terus meningkat terus meningkat, terutama di kawasan Asia dengan jumlah data 33% di Asia Tengah hingga 186% dalam rentang tahun 1990 hingga 2019 dan negara berpenghasilan menengah  \citep{feng2024epidemiology}. Kondisi ini tidak hanya berdampak pada peningkatan angka hospitalisasi dan readmission, tetapi juga mengurangi kualitas hidup pasien dan menambah beban ekonomi masyarakat serta fasilitas pelayanan kesehatan \citep{yan2023burden}. Dalam konteks tersebut, identifikasi dini pasien yang berisiko tinggi menjadi sangat penting untuk menekan angka rawat inap berulang dan mortalitas.

Dalam praktik klinis, penilaian risiko pasien gagal jantung masih banyak bergantung pada kombinasi penilaian subjektif klinisi, pedoman klinis, dan pengamatan terhadap berbagai parameter klinis secara manual. Berbagai penelitian juga memperkuat bahwa pasien gagal jantung memiliki angka readmission dan mortalitas jangka pendek yang tinggi yang merefleksikan belum optimal dalam stratifikasi risiko di layanan kesehatan \citep{sabouri2023machine}. Hal ini menimbulkan risiko bahwa sebagian pasien dengan profik risiko tinggi tidak teridentifikasi tepat waktu sehingga tidak mendapatkan prioritas pemantauan dan intervensi yang lebih intensif.

Seiring meluasnya penggunaan electronic health records (EHR), data klinis seperti karakteristik pasien, hasil laboratorium, diagnosis, prosedur, dan terapi kini tersimpan dalam jumlah besar dan relatif terstruktur di fasilitas pelayanan kesehatan. Integrasi data EHR dengan metode analitik, seperti kecerdasan buatan dan machine learning telah dilaporkan mampu mentransformasi cara prediksi dan manajemen risiko penyakit kardiovaskular \citep{tsai2025harnessing}. Berdasarkan penelitian lain menunjukkan, bahwa teknik data mining dapat dimanfaatkan untuk mengekstraksi parameter klinis penting serta data laboratorium guna memperbaiki subclassificiation gagal jantung \citep{vuori2023use}. 

Sejalan dengan perkembangan tersebut, berbagai algoritma klasifikasi seperti logistic regression, random forest, support vector machine, dan gradient boosting telah diterapkan untuk diagnosis, prediksi, dan prognosis gagal jantung, dengan performa yang umumnya lebih baik daripada skor risiko tradisional \citep{saqib2024machine}. Studi lain yang memanfaatkan Heart Failure Prediciton Dataset juga menunjukkan bahwa perbandingan beberapa model klasifikasi memungkinkan identifikasi algoritma yang optimal untuk klasifikasi gagal jantung \citep{chulde2025classification}. Di Indonesia, terdapat penelitian yang telah mengevaluasi berbagai model machine learning untuk memprediksi keparahan dan readmission pasien gagal jantung serta menemukan model dengan performa terbaik untuk diintegrasikan ke dalam aplikasi pemantauan mandiri pasien \citep{indriany2024predicting}. Meskipun demikian, diperlukan penerapan dan analisis model klasifikasi berbasis Random Forest untuk mengidentifikasi pasien berisiko tinggi gagal jantung sehingga dapat dibangun model prediksi dengan performa yang dapat menghasilkan pengetahui mengenai faktor-faktor klinis yang berkontribusi terhadap kategori risiko tinggi tersebut.

# Rumusan Masalah

1. Bagaimana karakteristik data klinis pasien gagal jantung yang ditanjau dari distirbusi kelas risiko serta variabel klinisnya?
2. Bagaimana kinerja model klasifikasi Random Forest dalam mengidentifikasi pasien berisiko tinggi gagal jantung berdasarkan metrik evaluasi seperti akurasi, presisi, recall, dan F1-score?
3. Fitur-fitur klinis apa saja yang paling berkontribusi terhadap penentuan kategori pasien berisiko tinggi gagal jantung berdasarkan hasil analisis model Random Forest?


# Tujuan Penelitian

1. Mendeskripsikan karakteristik data klinis pasien gagal jantung termasuk distirbusi kelas risiko dan variabel-variabel klinis yang relevan.
2. Membangun dan mengevaluasi model klasifikasi Random Forest untuk mengidentifikasi pasien berisiko tinggi gagal jantung menggunakan metrik evaluasi seperti akurasi, presisi, recall, dan F1-score.
3. Mengidentifikasi fitur-fitur klinis yang paling berpengaruh terhadap penentuan kategori pasien berisiko tinggi gagal jantung berdasarkan hasil analisis model Random Forest.

# Sumber dan Karakteristik Data

* **Sumber Data:** Dataset publik "Heart Failure Prediction Dataset" yang diperoleh dari platform Kaggle.
* **Karakteristik Data:** Dataset awal terdiri dari 918 observasi (baris) dan 12 variabel (kolom).
* **Target Variabel:** `HeartDisease` (Biner: 1 = Sakit Jantung, 0 = Normal).
* **Variabel Prediktor:** Mencakup data demografis (`Age`, `Sex`), data klinis (`RestingBP`, `Cholesterol`), dan hasil tes (`MaxHR`, `RestingECG`, dll.).
* **Kualitas Data:** Terdapat potensi masalah kualitas data, seperti nilai '0' yang tidak logis pada kolom `Cholesterol` dan `RestingBP`, yang harus ditangani pada tahap *Data Preparation*.

# Metodologi Data Mining (CRISP-DM)

Metodologi proyek mengikuti alur standar CRISP-DM.

## Tahap 1 & 2: Business & Data Understanding

Tahap ini mencakup pemahaman tujuan (telah dijelaskan di Latar Belakang) dan pemahaman data awal. Data dimuat dan diperiksa.

```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
library(tidyverse)
library(caret)
library(randomForest)
df <- read.csv("heart.csv")

glimpse(df)

summary(df)
```

**Representasi (Temuan Awal):**

Dari `summary(df)`, masalah kualitas data dapat dilihat:

1.  `RestingBP` memiliki nilai minimum `0`.
2.  `Cholesterol` memiliki nilai minimum `0`.

Kedua nilai ini tidak mungkin secara biologis dan akan ditangani sebagai data hilang.

## Tahap 3: Data Preparation

Ini adalah tahap kritis di mana data akan dibersihkan, diimputasi, dan dibagi.

Penjelasan langkah:

- Membersihkan baris dengan `RestingBP = 0` karena nilai tersebut tidak mungkin secara biologis; jumlah baris terdampak sedikit sehingga aman untuk dihapus.
- Melakukan pemisahan data latih/uji sebelum imputasi untuk mencegah data leakage (agar informasi dari data uji tidak ikut mempengaruhi proses training).

```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
df_clean <- df %>%
  filter(RestingBP > 0)
print(paste("Jumlah baris setelah membersihkan RestingBP:", nrow(df_clean)))

set.seed(26)
trainIndex <- createDataPartition(df_clean$HeartDisease, p = .8, 
                                  list = FALSE, 
                                  times = 1)
train_data <- df_clean[ trainIndex,]
test_data  <- df_clean[-trainIndex,]
```

```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
valid_chol_median <- train_data %>%
  filter(Cholesterol > 0) %>%
  summarise(MedianChol = median(Cholesterol, na.rm = TRUE)) %>%
  pull(MedianChol)

print(paste("Median kolesterol (dari data latih):", valid_chol_median))

train_data <- train_data %>%
  mutate(Cholesterol = ifelse(Cholesterol == 0, valid_chol_median, Cholesterol))

test_data <- test_data %>%
  mutate(Cholesterol = ifelse(Cholesterol == 0, valid_chol_median, Cholesterol))

categorical_cols <- c('Sex', 'ChestPainType', 'RestingECG', 'ExerciseAngina', 'ST_Slope', 'FastingBS', 'HeartDisease')

train_data <- train_data %>%
  mutate(across(all_of(categorical_cols), as.factor))

test_data <- test_data %>%
  mutate(across(all_of(categorical_cols), as.factor))

glimpse(train_data)
```

## Tahap 4: Modeling

Melatih model menggunakan data latih (`train_data`) dengan metode 10-Fold Cross-Validation (CV) untuk memastikan model stabil dan *robust*.

Penjelasan langkah:

- Menetapkan kontrol pelatihan `trainControl(method = "cv", number = 10)` agar evaluasi rata-rata dari 10 lipatan meningkatkan reliabilitas estimasi performa.
- Melatih Random Forest (`method = "rf"`) pada `train_data` dengan `preProcess = c("center", "scale")` untuk standarisasi fitur numerik (dampaknya kecil untuk RF namun praktik baik umum).
- Meninjau ringkasan model untuk melihat akurasi rata-rata dan metrik lain dari proses CV.

```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
set.seed(18)
trControl <- trainControl(method = "cv",
                          number = 10) 

model_rf <- train(HeartDisease ~ ., 
                  data = train_data, 
                  method = "rf",
                  trControl = trControl,
                  preProcess = c("center", "scale")
                 )

print(model_rf)
```

## Tahap 5: Evaluation

Model yang sudah dilatih (`model_rf`) kini dievaluasi kinerjanya menggunakan data uji (`test_data`) yang belum pernah dilihat sebelumnya.

Penjelasan langkah:

- Menghasilkan prediksi kelas pada `test_data` menggunakan model yang telah dilatih.
- Menghitung confusion matrix dan statistik evaluasi (akurasi, kappa, presisi, recall, dll.) untuk menilai kinerja model pada data yang tidak terlihat.

```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
y_pred <- predict(model_rf, newdata = test_data)
y_test <- test_data$HeartDisease

cm <- confusionMatrix(y_pred, y_test)
print(cm)
```

# Hasil yang Diharapkan dan Dampak

## Hasil Proyek (Representasi Output)

1.  **Model Prediktif:** Sebuah model R (`model_rf`) yang siap digunakan, yang terbukti memiliki akurasi **`r round(cm$overall['Accuracy'], 3)`** dan Kappa **`r round(cm$overall['Kappa'], 3)`** pada data uji.
2.  **Visualisasi Hasil (Confusion Matrix):**

    ```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
    # Plot heatmap confusion matrix
    cm_table <- as.data.frame(cm$table)
    ggplot(cm_table, aes(x = Reference, y = Prediction, fill = Freq)) +
      geom_tile(color = "white") +
      geom_text(aes(label = Freq), vjust = 1) +
      scale_fill_gradient(low = "white", high = "blue") +
      labs(title = "Confusion Matrix (Test Data)") +
      theme_minimal()
    ```
    Evaluasi model terhadap test data (data uji) divisualisasikan menggunakan heatmap confusion matrix. Hasilnya menunjukkan bahwa model memiliki kemampuan prediksi yang baik, dengan 89 True Positive (pasien sakit jantung teridentifikasi dengan benar) dan 69 True Negative (pasien normal teridentifikasi dengan benar).

    Meskipun demikian, model masih melakukan dua jenis kesalahan:

    - False Positive (Tipe I): Terdapat 9 kasus di mana pasien normal diprediksi mengalami sakit jantung.
    - False Negative (Tipe II): Terdapat 6 kasus di mana pasien yang sakit jantung diprediksi normal.

3.  **Insight Kunci (Variable Importance):** Ekstrak fitur apa yang dianggap paling penting oleh model.

    ```{r, eval=TRUE, warning=FALSE, message=FALSE, comment=NA, fig.align='center', out.width='50%'}
    var_imp <- varImp(model_rf)
    plot(var_imp, main = "Variable Importance (Faktor Paling Berpengaruh)")
    ```
    
    Analisis variable importance dari model Random Forest mengidentifikasi fitur-fitur klinis yang paling signifikan dalam menentukan prediksi.

    Berdasarkan plot, tiga prediktor paling berpengaruh adalah:

    - ST_Slope (terutama kategori Up dan Flat, yang menunjukkan kemiringan segmen ST)
    - Oldpeak (Depresi ST yang diinduksi oleh olahraga)
    - MaxHR (Detak jantung maksimum yang dicapai)

    Fitur-fitur yang terkait dengan hasil EKG dan tes fisik (ExerciseAngina) terbukti memiliki kontribusi yang jauh lebih tinggi daripada fitur demografis seperti Age (Usia) atau Sex (Jenis Kelamin).

## Dampak dan Potensi Penerapan

Berdasarkan hasil di atas (terutama *Variable Importance*), model dapat memberikan *insight* bagi praktisi medis. Model ini dapat digunakan sebagai **Sistem Pendukung Keputusan (Decision Support System)** untuk *screening* awal pasien. Pasien yang diprediksi memiliki risiko tinggi dapat segera dirujuk untuk pemeriksaan lebih lanjut, sehingga mempercepat proses diagnosis dan penanganan.

\newpage
\nocite{*}
   